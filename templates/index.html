<!DOCTYPE html>
<html>
<head>
    <title>AD Risk Assessment Demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        /* Medical UI style: clean teal, soft whitespace, thin card borders */
        body { background: linear-gradient(180deg, #f4f9ff 0%, #f7fbff 100%); color: #0f172a; }
        h1, h4, h5, h6 { letter-spacing: 0.3px; }
        .brand-title { font-weight: 700; color: #0ea5a5; }
        .sub-title { font-size: .95rem; color: #64748b; }
        .score-badge { font-size: 1rem; background: linear-gradient(90deg, #22d3ee 0%, #0ea5a5 100%); }
        .spectrogram { max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #e2e8f0; box-shadow: 0 2px 10px rgba(14,165,165,.08); }
        .card { border: 1px solid #e2e8f0; border-radius: 10px; }
        .card-title { color: #075985; font-weight: 600; }
        .btn-primary { background: linear-gradient(90deg, #0891b2 0%, #0ea5a5 100%); border: none; box-shadow: 0 4px 12px rgba(14,165,165,.2); }
        .btn-primary:hover { filter: brightness(1.02); }
        .form-label { color: #0f766e; font-weight: 600; }
        .info-note { color: #64748b; font-size: .9rem; }
        .muted { color: #94a3b8; }
        .advice-text { color: #0f766e; font-size: .9rem; margin-top: .5rem; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
<div class="container py-4">
    <h1 class="text-center mb-1 brand-title">Early Alzheimer's Risk Assessment from Multi-source Speech</h1>
    <p class="text-center sub-title mb-4">Language / Paralinguistic / Non-linguistic features · Graph reasoning · Clinically interpretable</p>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form action="/uploader" method="post" enctype="multipart/form-data" class="row g-3 align-items-end" onsubmit="handleSubmit(this)">
                <div class="col-md-6">
                    <label class="form-label">Upload audio (.wav)</label>
                    <input class="form-control" type="file" name="file" accept="audio/wav" required>
                    <div class="form-text info-note">Recommended 16kHz mono; medically relevant acoustic features will be extracted.</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Optional: transcript (for language features)</label>
                    <input class="form-control" type="text" name="transcript" placeholder="Leave empty if no ASR">
                    <div class="form-text info-note">若提供问答/叙述文本，将用于语言维度的连贯性与词汇统计。</div>
                </div>
                <div class="col-12">
                    <button class="btn btn-primary" id="submitBtn" type="submit">
                        <span class="spinner-border spinner-border-sm d-none" id="loadingSpinner" role="status" aria-hidden="true"></span>
                        <span id="btnText">Submit</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% if prediction %}
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title mb-3">Result</h5>
                    <p class="mb-2"><span class="badge text-white score-badge">Risk score: {{ risk_score }}</span></p>
                    <h4 class="text-primary">{{ prediction }}</h4>
                    <p class="muted mb-1">Tip: risk score ranges 0-1; larger is higher. Use clinical judgment.</p>
                    {% if advice %}
                        <div class="advice-text">Advice: {{ advice }}</div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm h-100">
                <div class="card-body">
                    <h5 class="card-title mb-3">Spectrogram</h5>
                    {% if image_url %}
                        <img class="spectrogram" src="{{ image_url }}" alt="Spectrogram Image">
                    {% else %}
                        <p class="text-muted">No spectrogram to display</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Interpretable feature details</h5>
            <div class="row">
                <div class="col-md-4">
                    <h6>Language</h6>
                    <pre class="small">{{ details.language | tojson(indent=2) }}</pre>
                </div>
                <div class="col-md-4">
                    <h6>Paralinguistic</h6>
                    <pre class="small">{{ details.paralinguistic | tojson(indent=2) }}</pre>
                </div>
                <div class="col-md-4">
                    <h6>Non-linguistic</h6>
                    <pre class="small">{{ details.nonlinguistic | tojson(indent=2) }}</pre>
                </div>
            </div>
            <div class="mt-2 info-note">Note: eGeMAPS and traditional acoustics (MFCC/Chroma/Contrast/Tonnetz) support decisions; graph reasoning detects cascade anomalies among cognitive/paralinguistic/physiological dimensions.</div>
        </div>
    </div>

    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Contribution shares (radar chart)</h5>
            <canvas id="radarChart" height="180"></canvas>
        </div>
    </div>
    <script id="contribData" type="application/json">{{ (contrib or {}) | tojson }}</script>
    <script>
        let contrib = {};
        try { contrib = JSON.parse(document.getElementById('contribData')?.textContent || '{}'); } catch(e) { contrib = {}; }
        if (Object.keys(contrib).length > 0) {
            const labels = ["cognitive", "paralinguistic", "physiological", "cog↔par", "par↔phy"];
            const data = labels.map(k => (contrib[k] || 0));
            const ctx = document.getElementById('radarChart');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Contribution',
                        data: data,
                        backgroundColor: 'rgba(14,165,165,0.18)',
                        borderColor: 'rgba(14,165,165,1)',
                        pointBackgroundColor: 'rgba(14,165,165,1)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { labels: { color: '#0f172a' } } },
                    scales: { r: { suggestedMin: 0, suggestedMax: 1, grid: { color: '#e2e8f0' }, pointLabels: { color: '#0f172a' }}}
                }
            });
        }

        function handleSubmit(form){
            const btn = document.getElementById('submitBtn');
            const spinner = document.getElementById('loadingSpinner');
            const text = document.getElementById('btnText');
            if(btn && spinner && text){
                spinner.classList.remove('d-none');
                text.textContent = 'Evaluating…';
                btn.setAttribute('disabled','disabled');
            }
        }
    </script>
    {% endif %}

    <footer class="text-center text-muted mt-4">Medical conclusions must be made by qualified professionals.</footer>
</div>
</body>
</html>
